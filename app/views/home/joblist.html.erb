<div class="container-fluid">
  <div class="border border-dark pb-3">
    <h1 class="h3 bg-secondary text-white p-2 mb-4">求人を検索</h1>
    <%= form_with url: "joblist", method: :get do |form| %>
      <div class="row">
        <!-- First Table (職種 & 給与) -->
        <div class="col-md-6">
          <table class="w-100">
            <tbody>
              <tr>
                <td class="text-end align-middle pe-2 pb-3">
                  <%= form.label :category_id, "職種", class: "form-label mb-0" %>
                </td>
                <td class="pb-3">
                <%= form.select :category_id, 
                    options_for_select(@categories), 
                    {prompt: "選択してください" },
                    { class: "form-select" } %>
                </td>
              </tr>
              <tr>
                <td class="text-end align-middle pe-2 pb-3">給与</td>
                <td class="d-flex pb-3">
                  <%= form.select :min_salary, 
                        options_for_select([["最低給与", "", { disabled: true, selected: true }]] + [[200_000, 200_000], [300_000, 300_000], [400_000, 400_000]]), 
                        {}, 
                        { class: "form-select me-2" } %>
                  <span class="align-self-center">〜</span>
                  <%= form.select :max_salary, 
                        options_for_select([["最高給与", "", { disabled: true, selected: true }]] + [[500_000, 500_000], [600_000, 600_000], [700_000, 700_000]]), 
                        {}, 
                        { class: "form-select ms-2" } %>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="text-start ms-5 ps-2 mt-3">
            <%= form.submit "検索", class: "btn btn-success btn-lg ms-5" %>
          </div>
        </div>

        <!-- Second Table (スキル & 通勤地) -->
        <div class="col-md-6 pe-5">
          <table class="w-100">
            <tbody>
              <tr>
                <td class="text-end align-middle pe-2 pb-3">
                  <%= form.label :skill_id, "スキル", class: "form-label mb-0" %>
                </td>
                <td class="pb-3">
                  <%= form.select :skill_id, 
                        options_for_select(@skills), 
                        {prompt: "選択してください"}, 
                        { class: "form-select", id: "skill_select" } %>
                </td>
              </tr>
              <tr>
                <td class="text-end align-middle pe-2 pb-3">
                  <%= form.label :location_id, "通勤地", class: "form-label mb-0" %>
                </td>
                <td class="pb-3">
                  <%= form.select :location_id, 
                        options_for_select(@locations), 
                        {prompt: "選択してください"}, 
                        { class: "form-select"} %>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Loop through the paginated job offers -->
  <% @joboffers.each do |job_offer| %>
    <div class="mt-4 border border-dark p-3">
      <div class="d-flex justify-content-between">
        <h1 class="h3 text-start text-success mb-4"><%= job_offer.category.title %></h1>
        <span class="">Posted <span class="badge bg-success fs-6 p-2 mx-2"><%= time_ago_in_words(job_offer.created_at) %></span> ago</span>
      </div>
    
      <div class="w-50">
        <table class="w-50 text-start">
          <tr>
            <th class="p-2">給料</th>
            <td class="p-2 badge bg-success fs-6 mb-2"><%= "#{job_offer.minsalary}~#{job_offer.maxsalary}" %></td>
          </tr>
          <tr>
            <th>勤務地</th>
            <td><a href="#" class="text-decoration-none text-secondary btn border-dark"><i class="fa-solid fa-location-dot me-2"></i><%= job_offer.location.city %></a></td>
          </tr>
        </table>
      </div>

      <p class="mt-3 w-75">
        <%= job_offer.description %>
      </p>

      <div class="w-50">
        <table class="w-50 text-start">
          <tr>
            <th class="fw-bold p-2">職種</th>
            <td class="p-2"><%= job_offer.category.title %></td>
          </tr>
        </table>
      </div>

      <div class="mt-2">
        <% job_offer.t_skills.each do |skill| %>
          <span class="badge bg-primary me-3 fs-6" style="color:white;"><%= skill.title %></span>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Pagination controls -->
<div class="mt-4 d-flex justify-content-start">
  <%= paginate @joboffers %>
</div>

</div>
<script>

document.addEventListener("DOMContentLoaded", function () {
  const skillSelect = document.getElementById("skill_select");

  if (skillSelect) {
    skillSelect.addEventListener("click", function () {
      skillSelect.setAttribute("multiple", "true");
    });
  }
});
</script>